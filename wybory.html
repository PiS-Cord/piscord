<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Wybory</title>
<script src="arkusze.js"></script>

<style>
body { font-family: Arial; text-align:center; }

input, select {
  padding:8px;
  margin:5px;
}

.candidate {
  padding:10px;
  margin:5px;
  border-radius:6px;
  color:white;
  cursor:pointer;
  display:inline-block;
}
table {
  margin:auto;
  border-collapse: collapse;
  width: 80%;
}
table, th, td {
  border: 1px solid #000;
  padding: 5px;
  text-align:center;
}
</style>
</head>
<body>

<h1>Wybory</h1>

<div>
  <input id="nick" placeholder="Nick Discord">
  <input id="discordId" placeholder="Discord ID">
  <select id="wojewodztwo">
    <option>Mazowieckie</option>
    <option>Śląskie</option>
    <option>Małopolskie</option>
  </select>
</div>

<h3>Wybierz kandydata</h3>
<div id="candidates"></div>

<h3>Wyniki</h3>
<table id="votesTable">
  <thead>
    <tr>
      <th>ID głosu</th>
      <th>Nick Discord</th>
      <th>Discord ID</th>
      <th>Województwo</th>
      <th>Kandydat</th>
      <th>Data / Godzina</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// =======================
// KONFIG KANDYDATÓW
// =======================
const candidates = {
  A: { name: "Kandydat A", color: "#e63946" },
  B: { name: "Kandydat B", color: "#1d3557" },
  C: { name: "Kandydat C", color: "#2a9d8f" }
};

// =======================
// GENEROWANIE PRZYCISKÓW
// =======================
const container = document.getElementById("candidates");
for (const key in candidates) {
  const div = document.createElement("div");
  div.className = "candidate";
  div.textContent = candidates[key].name;
  div.style.backgroundColor = candidates[key].color;
  div.onclick = () => vote(key);
  container.appendChild(div);
}

// =======================
// ODDANIE GŁOSU
// =======================
async function vote(candidate){
  const nick = document.getElementById("nick").value.trim();
  const discordId = document.getElementById("discordId").value.trim();
  const woj = document.getElementById("wojewodztwo").value;

  if(!nick || !discordId){
    alert("Podaj nick i Discord ID");
    return;
  }

  const voteId = "V" + Date.now();
  const timestamp = new Date().toISOString();

  await Arkusze.appendRow("Arkusz1", [
    "",        // kolumna A pusta
    voteId,    // B
    nick,      // C
    discordId, // D
    woj,       // E
    candidate, // F
    timestamp  // G
  ]);

  await loadTable();
  alert("Głos zapisany.");
}

// =======================
// TABELA GŁOSÓW
// =======================
async function loadTable() {
  let dataText = await Arkusze.getAll("Arkusz1");
  let data = [];
  try {
    data = JSON.parse(dataText);
  } catch(e) {
    console.warn("Niepoprawny JSON z arkusza, ignoruję wiersze:", dataText);
    return;
  }

  const tbody = document.querySelector("#votesTable tbody");
  tbody.innerHTML = ""; 

  // filtrujemy wiersze, które mają ID głosu (kolumna B = indeks 1)
  const filtered = data.filter(row => row[1] && row[1].toString().trim() !== "");

  filtered.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row[1]}</td>   <!-- ID głosu -->
      <td>${row[2]}</td>   <!-- Nick Discord -->
      <td>${row[3]}</td>   <!-- Discord ID -->
      <td>${row[4]}</td>   <!-- Województwo -->
      <td>${row[5]}</td>   <!-- Kandydat -->
      <td>${row[6]}</td>   <!-- Timestamp -->
    `;
    tbody.appendChild(tr);
  });
}

// =======================
// AUTOLOAD
// =======================
loadTable();
setInterval(loadTable, 5000);

</script>
</body>
</html>
